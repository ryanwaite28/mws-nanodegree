"use strict";!function(){var d=!1,t=void 0;function n(){(t=document.getElementById("cancel-editing-btn")).addEventListener("click",function(){s()}),document.getElementById("submit-form-btn").addEventListener("click",function(){!function(){var e={name:document.getElementById("name-field").value.trim(),rating:document.getElementById("rating-field").value.trim(),comments:document.getElementById("comments-field").value.trim()};if(!/[a-zA-Z]{2,}$/gi.test(e.name))return alert("name input must be letters only, minimum of 2 characters");if(!/[1-5]{1}$/gi.test(e.rating))return alert("rating input must be a number, 1-5");if(e.comments.length<3)return alert("comments input must be minimum of 3 characters");d||(e.restaurant_id=Number(getParameterByName("id")));try{DBHelper.submitReview(e,d).then(function(e){var t=d?"Edited Review!":"Created Review!";alert(t);var n=createReviewHTML(e);if(d){var r=document.getElementById("review-li-"+e.id),a=r.parentElement;a.replaceChild(n,r)}else{var i=document.getElementById("reviews-list");i.appendChild(n)}s();var l=document.getElementById("review-li-"+e.id);l.scrollIntoView&&l.scrollIntoView.constructor===Function&&l.scrollIntoView(!0)}).catch(function(e){console.log("error...",e);var t=d?"Could not edit this review. please try again later.":"Could not create review. Please Check network connection.";alert(t)})}catch(e){console.log("error...",e);var t=d?"Could not edit this review. please try again later.":"Could not create review. Please Check network connection.";alert(t)}}()}),fetchRestaurantFromURL(function(e,t){s(),e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),DBHelper.fetchReviews(self.restaurant.id,function(e,t){fillReviewsHTML(t)}))})}function s(e){e?(d=e,document.getElementById("form-header").innerHTML="Edit "+d.name+"'s review",document.getElementById("name-field").value=d.name,document.getElementById("rating-field").value=d.rating,document.getElementById("comments-field").value=d.comments,t.style.display="block"):(d=!1,document.getElementById("form-header").innerHTML="Create a review",document.getElementById("name-field").value="",document.getElementById("rating-field").value="",document.getElementById("comments-field").value="",t.style.display="none")}window.initMap=function(){try{DBHelper.syncReviews().then(function(){n()})}catch(e){console.log("error: could not sync reviews..."),n()}},fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fillRestaurantHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant:arguments[0];document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.setAttribute("alt",e.name+" ("+e.neighborhood+")"),t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type;var n=DBHelper.renderFavBtn(e);document.getElementById("restaurant-container").appendChild(n),e.operating_hours&&fillRestaurantHoursHTML()},fillRestaurantHoursHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant.operating_hours:arguments[0],t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant.reviews:arguments[0],t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",n.className="text-center",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},determineRatingClass=function(e){var t=void 0;return e<=2&&(t="rating-bad"),3==e&&(t="rating-fair"),4<=e&&(t="rating-good"),t},createReviewHTML=function(e){var t=document.createElement("li");t.setAttribute("id","review-li-"+e.id),t.setAttribute("data-restaurant-id",e.restaurant_id);var n=document.createElement("p");n.setAttribute("id","review-name-"+e.id),n.innerHTML=e.name,n.className="review-name",t.appendChild(n);var r=document.createElement("div");r.className="review-info-container";var a=document.createElement("p");a.innerHTML="<span><strong>Created:</strong> "+new Date(e.createdAt).toDateString()+"</span>",a.style.fontSize="1.25rem",r.appendChild(a);var i=document.createElement("p");i.innerHTML="<span><strong>Updated:</strong> "+new Date(e.updatedAt).toDateString()+"</span>",i.style.fontSize="1.25rem",r.appendChild(i);var l=document.createElement("p"),d=document.createElement("span");d.setAttribute("id","rating-"+e.id),d.className=determineRatingClass(e.rating),d.className+=" rating-span",d.innerHTML="Rating: "+e.rating,l.appendChild(d),r.appendChild(l);var o=document.createElement("p");o.setAttribute("id","review-comments-"+e.id),o.innerHTML=e.comments,o.style.fontSize="1.0rem",r.appendChild(o);var m=DBHelper.renderDeleteReviewBtn(e);r.appendChild(m);var c=DBHelper.renderEditReviewBtn(e);return c.addEventListener("click",function(){s(e),window.scrollTo(0,document.body.scrollHeight||document.documentElement.scrollHeight)}),r.appendChild(c),t.append(r),t},fillBreadcrumb=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant:arguments[0],t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},formatDate=function(e){new Date(e)}}();